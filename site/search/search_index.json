{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Surprise","title":"Home"},{"location":"Confluence/","text":"Confluence setup: DB: Download: download mysql80-community-release # sudo rpm -ivh mysql80-community-release-el7-3.noarch.rpm # sudo rpm -pql mysql80-community-release-el7-3.noarch.rpm # sudo md5sum mysql80-community-release-el7-3.noarch.rpm # sudo grep 'temporary password' /var/log/mysqld.log # sudo mysql_secure_installation Connect to the database: # mysql -h 127.0.0.1 -P 3308 -u netset -pword -e \"SHOW VARIABLES LIKE '%max_connections%';\" # mysql -u root Note1: I use JNDI datasource connection SHOW in DATABASE: > SHOW VARIABLES LIKE 'innodb_log_file_size'; > SHOW VARIABLES LIKE 'max_allowed_packet'; > SHOW VARIABLES LIKE '%max_connections%'; > SHOW VARIABLES LIKE '%innodb_strict_mode%'; for Zabbix server > SHOW VARIABLES LIKE '%validate_password%'; > show global variables like 'local_infile'; > SELECT DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME FROM information_schema.SCHEMATA WHERE schema_name = 'confluence'; > SELECT title, lastmoddate FROM CONTENT group by lastmoddate; > SELECT User, Host, plugin, authentication_string FROM mysql.user; SHOW PRIVILIGES: > show grants for 'netset'@'localhost'; > SET GLOBAL local_infile=1; SHOW tatal nember of tables: >SELECT count(*) AS TOTALNUMBEROFTABLES FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'confluence'; Modify DATABASE: > CREATE DATABASE confluence character set utf8 collate utf8_bin; > ALTER DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin; > CREATE USER 'netset'@'localhost' IDENTIFIED BY 'word'; > GRANT ALL ON confluence.* TO 'netset'@'localhost'; > FLUSH PRIVILEGES; > UPDATE user SET plugin='mysql_native_password' WHERE User='netset'; > ALTER USER 'root'@'localhost' IDENTIFIED BY ''; OR > UPDATE mysql.user SET authentication_string = PASSWORD('') WHERE User = 'netset' AND Host = 'localhost'; OR > SET PASSWORD FOR 'netset'@'localhost' = PASSWORD(''); > SET GLOBAL mysqlx_max_connections = 300; > SET GLOBAL max_connections = 300; > SET GLOBAL max_connections = 500; > SET GLOBAL innodb_log_file_size=2000000; > SET GLOBAL max_allowed_packet=1073741824; > SET GLOBAL sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE, ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'; > SET session sql_mode=\"STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE, ERROR_FOR_DIVISION_BY_ZERO, NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\"; > SET GLOBAL validate_password.policy=LOW; > SET GLOBAL validate_password.mixed_case_count = 0; > SET GLOBAL validate_password.number_count = 0; > SET GLOBAL validate_password.check_user_name = 0; > SET GLOBAL validate_password.special_char_count = 0; > SET GLOBAL validate_password.LENGTH = 0; ALTER TABLE table_name > DROP COLUMN column_name; Modify database in conf file: [mysqld] validate_password.length=0 validate_password.mixed_case_count=0 validate_password.number_count=0 validate_password.policy=LOW validate_password.special_char_count=0 default-storage-engine=INNODB innodb_log_file_size=2GB max_allowed_packet=256M binlog_format=row character-set-server=utf8 collation-server=utf8_bin sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION ============================================================== Free the memory from caches first level: # sync; echo 1 > /proc/sys/vm/drop_caches ============================================================== App: 1- Add work directory (Home directory) to the installation directory: # nano -w atlassian-confluence-7.11.1/confluence/WEB-INF/classes/confluence-init.properties confluence.home=/home/confluence/confluence-7.10.2.1 2- copy the database connector: # cp confluence/confluence/WEB-INF/lib/mysql-connector-java-5.1.47.jar atlassian-confluence-7.11.1/confluence/WEB-INF/lib/ 3- copy the sever conf file: # cp confluence/conf/server.xml atlassian-confluence-7.11.1/conf/ Note: jdbc:mysql://localhost:3306/db?allowPublicKeyRetrieval=true&useSSL=false 4- unlink confluence and link new confluence: # ln -s atlassian-confluence-7.11.1 confluence 4- sudo rm -r logs/ sudo rm -r temp/ sudo rm -r plugins-cache/ sudo rm -r plugins-osgi-cache/ sudo rm -r plugins-temp/* 6- CATALINA_OPTS=\"-Xms1024m -Xmx6000m -XX:+UseG1GC ${CATALINA_OPTS}\" JRE_HOME=\"/opt/jre11\" 7- chown -R confluence:confluence atlassian-confluence-7.11.1 chown -R confluence:confluence /home/confluence/confluence-7.11.1/ jar -xf confluence-7.11.1.jar and change nano -w databaseSubsystemContext.xml DESCRIBE [table name]; DENORMALISED_SPACE_VIEW_PERMISSIONS DENORMALISED_SPACE_EDIT_PERMISSIONS DENORMALISED_SID DROP table MIG_EXCLUDE_APP; MIG_APP_ACCESS_SCOPE; SELECT max(lastmoddate) FROM ATTACHMENTS; select TITLE, LASTMODIFIER, LASTMODDATE, USERNAME from CONTENT group by TITLE; select * from CONTENT LIMIT 1; SELECT email_address AS \"email\", user_name AS \"username\", display_name AS \"displayname\", active AS \"active\" FROM cwd_user; Configuration: 1- JAVA 8 ELLER JAVA 11 1- JAVA eller JRE 2- MYSQL ELLER MARIADB 3- MYSQL 5.7 eller 8.0.23 4- mysql-connector-java-8.0.23.jar (saknar datetimelocal )eller \u00e4ldre 5.1.47 5- xmx=6000 6- Attachments folder in HOME_dir","title":"Confluence Setup"},{"location":"Confluence/#confluence-setup","text":"","title":"Confluence setup:"},{"location":"Confluence/#db","text":"","title":"DB:"},{"location":"Confluence/#download","text":"download mysql80-community-release # sudo rpm -ivh mysql80-community-release-el7-3.noarch.rpm # sudo rpm -pql mysql80-community-release-el7-3.noarch.rpm # sudo md5sum mysql80-community-release-el7-3.noarch.rpm # sudo grep 'temporary password' /var/log/mysqld.log # sudo mysql_secure_installation Connect to the database: # mysql -h 127.0.0.1 -P 3308 -u netset -pword -e \"SHOW VARIABLES LIKE '%max_connections%';\" # mysql -u root Note1: I use JNDI datasource connection","title":"Download:"},{"location":"Confluence/#show-in-database","text":"> SHOW VARIABLES LIKE 'innodb_log_file_size'; > SHOW VARIABLES LIKE 'max_allowed_packet'; > SHOW VARIABLES LIKE '%max_connections%'; > SHOW VARIABLES LIKE '%innodb_strict_mode%'; for Zabbix server > SHOW VARIABLES LIKE '%validate_password%'; > show global variables like 'local_infile'; > SELECT DEFAULT_CHARACTER_SET_NAME, DEFAULT_COLLATION_NAME FROM information_schema.SCHEMATA WHERE schema_name = 'confluence'; > SELECT title, lastmoddate FROM CONTENT group by lastmoddate; > SELECT User, Host, plugin, authentication_string FROM mysql.user; SHOW PRIVILIGES: > show grants for 'netset'@'localhost'; > SET GLOBAL local_infile=1; SHOW tatal nember of tables: >SELECT count(*) AS TOTALNUMBEROFTABLES FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'confluence';","title":"SHOW in DATABASE:"},{"location":"Confluence/#modify-database","text":"> CREATE DATABASE confluence character set utf8 collate utf8_bin; > ALTER DATABASE confluence CHARACTER SET utf8 COLLATE utf8_bin; > CREATE USER 'netset'@'localhost' IDENTIFIED BY 'word'; > GRANT ALL ON confluence.* TO 'netset'@'localhost'; > FLUSH PRIVILEGES; > UPDATE user SET plugin='mysql_native_password' WHERE User='netset'; > ALTER USER 'root'@'localhost' IDENTIFIED BY ''; OR > UPDATE mysql.user SET authentication_string = PASSWORD('') WHERE User = 'netset' AND Host = 'localhost'; OR > SET PASSWORD FOR 'netset'@'localhost' = PASSWORD(''); > SET GLOBAL mysqlx_max_connections = 300; > SET GLOBAL max_connections = 300; > SET GLOBAL max_connections = 500; > SET GLOBAL innodb_log_file_size=2000000; > SET GLOBAL max_allowed_packet=1073741824; > SET GLOBAL sql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE, ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION'; > SET session sql_mode=\"STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE, ERROR_FOR_DIVISION_BY_ZERO, NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION\"; > SET GLOBAL validate_password.policy=LOW; > SET GLOBAL validate_password.mixed_case_count = 0; > SET GLOBAL validate_password.number_count = 0; > SET GLOBAL validate_password.check_user_name = 0; > SET GLOBAL validate_password.special_char_count = 0; > SET GLOBAL validate_password.LENGTH = 0; ALTER TABLE table_name > DROP COLUMN column_name;","title":"Modify DATABASE:"},{"location":"Confluence/#modify-database-in-conf-file","text":"[mysqld] validate_password.length=0 validate_password.mixed_case_count=0 validate_password.number_count=0 validate_password.policy=LOW validate_password.special_char_count=0 default-storage-engine=INNODB innodb_log_file_size=2GB max_allowed_packet=256M binlog_format=row character-set-server=utf8 collation-server=utf8_bin sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION ============================================================== Free the memory from caches first level: # sync; echo 1 > /proc/sys/vm/drop_caches ==============================================================","title":"Modify database in conf file:"},{"location":"Confluence/#app","text":"1- Add work directory (Home directory) to the installation directory: # nano -w atlassian-confluence-7.11.1/confluence/WEB-INF/classes/confluence-init.properties confluence.home=/home/confluence/confluence-7.10.2.1 2- copy the database connector: # cp confluence/confluence/WEB-INF/lib/mysql-connector-java-5.1.47.jar atlassian-confluence-7.11.1/confluence/WEB-INF/lib/ 3- copy the sever conf file: # cp confluence/conf/server.xml atlassian-confluence-7.11.1/conf/ Note: jdbc:mysql://localhost:3306/db?allowPublicKeyRetrieval=true&useSSL=false 4- unlink confluence and link new confluence: # ln -s atlassian-confluence-7.11.1 confluence 4- sudo rm -r logs/ sudo rm -r temp/ sudo rm -r plugins-cache/ sudo rm -r plugins-osgi-cache/ sudo rm -r plugins-temp/* 6- CATALINA_OPTS=\"-Xms1024m -Xmx6000m -XX:+UseG1GC ${CATALINA_OPTS}\" JRE_HOME=\"/opt/jre11\" 7- chown -R confluence:confluence atlassian-confluence-7.11.1 chown -R confluence:confluence /home/confluence/confluence-7.11.1/","title":"App:"},{"location":"Confluence/#_1","text":"jar -xf confluence-7.11.1.jar and change nano -w databaseSubsystemContext.xml DESCRIBE [table name]; DENORMALISED_SPACE_VIEW_PERMISSIONS DENORMALISED_SPACE_EDIT_PERMISSIONS DENORMALISED_SID DROP table MIG_EXCLUDE_APP; MIG_APP_ACCESS_SCOPE; SELECT max(lastmoddate) FROM ATTACHMENTS; select TITLE, LASTMODIFIER, LASTMODDATE, USERNAME from CONTENT group by TITLE; select * from CONTENT LIMIT 1; SELECT email_address AS \"email\", user_name AS \"username\", display_name AS \"displayname\", active AS \"active\" FROM cwd_user;","title":""},{"location":"Confluence/#_2","text":"Configuration: 1- JAVA 8 ELLER JAVA 11 1- JAVA eller JRE 2- MYSQL ELLER MARIADB 3- MYSQL 5.7 eller 8.0.23 4- mysql-connector-java-8.0.23.jar (saknar datetimelocal )eller \u00e4ldre 5.1.47 5- xmx=6000 6- Attachments folder in HOME_dir","title":""},{"location":"add-secondarey-dns-server/","text":"On the primary server side: 1- added new key in named.conf.keys # nano -w named.conf.keys key dns2 { algorithm hmac-sha1; secret \"+hItdqx5Q+jvuKVrrBEdp+kotR8=\"; }; server 85.118.202.8 { keys { dns2 ;}; }; 1.1- restart service to activate the change # sudo jexec nameserver rndc reconfig 2- added new line in acl recurseallow added new line in allow-transfer # nano -w named.conf.options 85.118.202.8; 2.1- activate the changes: # sudo jexec nameserver rndc reconfig check the status: # less /srv/jails/nameserver/var/log/messages On the secondary server side: 1- Create key: # tsig-keygen -a hmac-sha1 dns2 > dns2.key 2- use the key in the configuration: # nano -w /etc/named.conf.d/keys.conf key \"dns2\" { algorithm hmac-sha1; secret \"+hItdqx5Q+jvuKVrrBEdp+kotR8=\"; }; server 194.16.65.242 { keys { dns2; }; }; 3- Create Zones configuration: # nano -w /etc/named.conf.d/zones.conf zone \"netset.se\" { type slave; file \"/etc/named.conf.d/zones/db.netset.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.us\" { type slave; file \"/etc/named.conf.d/zones/db.netset.us\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.nu\" { type slave; file \"/etc/named.conf.d/zones/db.netset.nu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.eu\" { type slave; file \"/etc/named.conf.d/zones/db.netset.eu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.asia\" { type slave; file \"/etc/named.conf.d/zones/db.netset.asia\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"tradepoint.se\" { type slave; file \"/etc/named.conf.d/zones/db.tradepoint.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"240-28.65.16.194.in-addr.arpa\" { type slave; file \"/etc/named.conf.d/zones/db.194.16.65\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"cries.se\" { type slave; file \"/etc/named.conf.d/zones/db.cries.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.co.uk\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.co.uk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.com\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.se\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netailer.se\" { type slave; file \"/etc/named.conf.d/zones/db.netailer.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"my-secure-shop.eu\" { type slave; file \"/etc/named.conf.d/zones/db.my-secure-shop.eu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.dk\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.dk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netailer.dk\" { type slave; file \"/etc/named.conf.d/zones/db.netailer.dk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.no\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.no\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netailer.eu\" { type slave; file \"/etc/named.conf.d/zones/db.netailer.eu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.io\" { type slave; file \"/etc/named.conf.d/zones/db.netset.io\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netshore.com\" { type slave; file \"/etc/named.conf.d/zones/db.netshore.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.co.uk\" { type slave; file \"/etc/named.conf.d/zones/db.netset.co.uk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.com\" { type slave; file \"/etc/named.conf.d/zones/db.netset.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netsetdemo.com\" { type slave; file \"/etc/named.conf.d/zones/db.netsetdemo.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; 4- Check the default settings: # less /etc/named.conf 5- check settings is ok # named-checkconf # named-checkzone unixmen.local /var/named/forward.unixmen # named-checkconf /etc/named.conf 6- Port # firewall-cmd --permanent --add-port=53/udp # firewall-cmd --permanent --add-port=53/tcp # firewall-cmd --reload +# firewall-cmd --list-all Note1: Cygrids DNS servers: @dns01.cygrids.net @dns02.cygrids.net 85.118.200.201 Troublshooting: 1- reverse dns finns hos IP \u00e4garen #dig -x IP_ADDRESS 2-Network unreachable on IPv6: add OPTIONS=\"-4\" to nano -w /etc/sysconfig/named Note2: You should add Nameserver: ns4.netset.se hos dom\u00e4n registraren. netset.com hos godaddy netset.se hos Loopia -------------------------------------------------------- DNSSEC: # sudo dnssec-keygen -a RSASHA256 -b 2048 -n ZONE netsetdemo.com # sudo dnssec-keygen -f KSK -a RSASHA256 -b 4096 -n ZONE netsetdemo.com # dnssec-signzone -3 f55345c0803300b4 -A -N INCREMENT -o netsetdemo.com -t netsetdemo.com.hosts KSK=257 ZSK=256 RSASHA256= algorithm 8 flags aa=authoritative name server ra= recursive name server ad= the DNSSEC is enabled and used # dig DNSKEY netsetdemo.com. +multiline # dig +trace +noadditional DS netsetdemo.com. @8.8.8.8 | grep DS # dig @8.8.8.8 netsetdemo.com. DS # dig @ns.netset.se netset119.netset.com A +cd #!/bin/sh PDIR=`pwd` ZONEDIR=\"/srv/jails/nameserver/usr/local/etc/namedb\" #location of your zone files ZONE=$1 ZONEFILE=$2 DNSSERVICE=\"named\" #On CentOS/Fedora replace this with \"named\" cd $ZONEDIR SERIAL=`sudo jexec nameserver rndc zonestatus netsetdemo.com | grep signed |egrep -ho '[0-9]{10}'` sed -i 's/'$SERIAL'/'$(($SERIAL+1))'/' $ZONEFILE sudo dnssec-signzone -A -3 f55345c0803300b4 -N increment -o $1 -t $2 cd $PDIR # sudo jexec nameserver rndc reconfig # Add the keys to working directory named/working/ Test 1: lyckades cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze netsetdemo.com sudo nano -w netsetdemo.com.hosts % the key\u015b are in separate folder sudo dnssec-signzone -g -d keys/netsetdemo_256.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netsetdemo.com -t netsetdemo.com.hosts keys/netsetdemo_256.keys/Knetsetdemo.com.+008+02763.private keys/netsetdemo_256.keys/Knetsetdemo.com.+008+59581.private % If the keys are in the same folder as zonefile and the SOA serial is incremntal (not recommended) sudo dnssec-signzone -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -N INCREMENT -o netsetdemo.com -t netsetdemo.com.hosts sudo jexec nameserver rndc reload netsetdemo.com sudo jexec nameserver rndc thaw netsetdemo.com sudo jexec nameserver rndc zonestatus netsetdemo.com less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc status sudo jexec nameserver rndc signing -list netsetdemo.com ==================================================== ZONE: netset.co.uk # cd /srv/jails/nameserver/usr/local/etc/namedb # sudo jexec nameserver rndc freeze netset.co.uk # sudo nano -w netset.co.uk.hosts # sudo dnssec-signzone -d keys/netset.co.uk.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.co.uk -t netset.co.uk.hosts keys/netset.co.uk.keys/Knetset.co.uk.+008+32134.private keys/netset.co.uk.keys/Knetset.co.uk.+008+42756.private # sudo jexec nameserver rndc reload netset.co.uk # sudo jexec nameserver rndc thaw netset.co.uk # sudo jexec nameserver rndc zonestatus netset.co.uk # less /srv/jails/nameserver/var/log/messages # sudo jexec nameserver rndc status ==================================================== Zone: nettailer.com sudo dnssec-keygen -a RSASHA256 -b 2048 -n ZONE nettailer.com sudo dnssec-keygen -f KSK -a RSASHA256 -b 4096 -n ZONE nettailer.com sudo jexec nameserver rndc freeze nettailer.com sudo nano -w nettailer.com.hosts sudo dnssec-signzone -d keys/nettailer.com.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.com -t nettailer.com.hosts keys/nettailer.com.keys/Knettailer.com.+008+65085.private keys/nettailer.com.keys/Knettailer.com.+008+61729.private sudo jexec nameserver rndc reload nettailer.com sudo jexec nameserver rndc thaw nettailer.com sudo jexec nameserver rndc zonestatus nettailer.com sudo jexec nameserver rndc status ==================================================== Zone: netset.io Edit zone then sudo dnssec-signzone -d keys/netset.io.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.io -t netset.io.hosts keys/netset.io.keys/Knetset.io.+008+16549.private keys/netset.io.keys/Knetset.io.+008+44718.private Then sudo jexec nameserver rndc reload sudo jexec nameserver rndc zonestatus netset.io less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc status ==================================================== Zone: netset.com 5 8 * * Mon /usr/home/nsadmin/sign-netset.com-zone cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze netset.com sudo nano -w netset.com.hosts sudo dnssec-signzone -d keys/netset.com.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.com -t netset.com.hosts keys/netset.com.keys/Knetset.com.+008+36214.private keys/netset.com.keys/Knetset.com.+008+64908.private sudo jexec nameserver rndc reload netset.com sudo jexec nameserver rndc thaw netset.com sudo jexec nameserver rndc zonestatus netset.com less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc status ==================================================== Zone: nettailer.co.uk cd /srv/jails/nameserver/usr/local/etc/namedb sudo nano -w nettailer.co.uk.hosts sudo dnssec-signzone -d keys/nettailer.co.uk.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.co.uk -t nettailer.co.uk.hosts keys/nettailer.co.uk.keys/Knettailer.co.uk.+008+23700.private keys/nettailer.co.uk.keys/Knettailer.co.uk.+008+45094.private sudo jexec nameserver rndc reload less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc zonestatus nettailer.co.uk ==================================================== Zone: netset.se cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze netset.se sudo nano -w netset.se.hosts sudo dnssec-signzone -d keys/netset.se.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.se -t netset.se.hosts keys/netset.se.keys/Knetset.se.+008+60556.private keys/netset.se.keys/Knetset.se.+008+04146.private sudo jexec nameserver rndc reload netset.se sudo jexec nameserver rndc thaw netset.se less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc zonestatus netset.se Zone: nettailer.se cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze nettailer.se sudo nano -w nettailer.se.hosts sudo dnssec-signzone -d keys/nettailer.se.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.se -t nettailer.se.hosts keys/nettailer.se.keys/Knettailer.se.+008+02454.private keys/nettailer.se.keys/Knettailer.se.+008+25465.private sudo jexec nameserver rndc reload nettailer.se sudo jexec nameserver rndc thaw nettailer.se less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc zonestatus nettailer.se ======================================================= Zone:nettailer.dk sudo dnssec-signzone -d keys/nettailer.dk.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.dk -t nettailer.dk.hosts keys/nettailer.dk.keys/Knettailer.dk.+008+46938.private keys/nettailer.dk.keys/Knettailer.dk.+008+22066.private ======================================================= Zone: netset.eu sudo jexec nameserver rndc freeze netset.eu sudo nano -w netset.eu.hosts sudo dnssec-signzone -d keys/netset.eu.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.eu -t netset.eu.hosts keys/netset.eu.keys/Knetset.eu.+008+54198.private keys/netset.eu.keys/Knetset.eu.+008+37339.private sudo jexec nameserver rndc reload netset.eu sudo jexec nameserver rndc thaw netset.eu less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc zonestatus netset.eu ========================================================","title":"Add-secondary-dns-server"},{"location":"add-secondarey-dns-server/#on-the-primary-server-side","text":"1- added new key in named.conf.keys # nano -w named.conf.keys key dns2 { algorithm hmac-sha1; secret \"+hItdqx5Q+jvuKVrrBEdp+kotR8=\"; }; server 85.118.202.8 { keys { dns2 ;}; }; 1.1- restart service to activate the change # sudo jexec nameserver rndc reconfig 2- added new line in acl recurseallow added new line in allow-transfer # nano -w named.conf.options 85.118.202.8; 2.1- activate the changes: # sudo jexec nameserver rndc reconfig check the status: # less /srv/jails/nameserver/var/log/messages","title":"On the primary server side:"},{"location":"add-secondarey-dns-server/#on-the-secondary-server-side","text":"1- Create key: # tsig-keygen -a hmac-sha1 dns2 > dns2.key 2- use the key in the configuration: # nano -w /etc/named.conf.d/keys.conf key \"dns2\" { algorithm hmac-sha1; secret \"+hItdqx5Q+jvuKVrrBEdp+kotR8=\"; }; server 194.16.65.242 { keys { dns2; }; }; 3- Create Zones configuration: # nano -w /etc/named.conf.d/zones.conf zone \"netset.se\" { type slave; file \"/etc/named.conf.d/zones/db.netset.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.us\" { type slave; file \"/etc/named.conf.d/zones/db.netset.us\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.nu\" { type slave; file \"/etc/named.conf.d/zones/db.netset.nu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.eu\" { type slave; file \"/etc/named.conf.d/zones/db.netset.eu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.asia\" { type slave; file \"/etc/named.conf.d/zones/db.netset.asia\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"tradepoint.se\" { type slave; file \"/etc/named.conf.d/zones/db.tradepoint.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"240-28.65.16.194.in-addr.arpa\" { type slave; file \"/etc/named.conf.d/zones/db.194.16.65\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"cries.se\" { type slave; file \"/etc/named.conf.d/zones/db.cries.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.co.uk\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.co.uk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.com\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.se\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netailer.se\" { type slave; file \"/etc/named.conf.d/zones/db.netailer.se\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"my-secure-shop.eu\" { type slave; file \"/etc/named.conf.d/zones/db.my-secure-shop.eu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.dk\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.dk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netailer.dk\" { type slave; file \"/etc/named.conf.d/zones/db.netailer.dk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"nettailer.no\" { type slave; file \"/etc/named.conf.d/zones/db.nettailer.no\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netailer.eu\" { type slave; file \"/etc/named.conf.d/zones/db.netailer.eu\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.io\" { type slave; file \"/etc/named.conf.d/zones/db.netset.io\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netshore.com\" { type slave; file \"/etc/named.conf.d/zones/db.netshore.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.co.uk\" { type slave; file \"/etc/named.conf.d/zones/db.netset.co.uk\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netset.com\" { type slave; file \"/etc/named.conf.d/zones/db.netset.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; zone \"netsetdemo.com\" { type slave; file \"/etc/named.conf.d/zones/db.netsetdemo.com\"; masters { 194.16.65.242; }; allow-transfer { key dns2; }; }; 4- Check the default settings: # less /etc/named.conf 5- check settings is ok # named-checkconf # named-checkzone unixmen.local /var/named/forward.unixmen # named-checkconf /etc/named.conf 6- Port # firewall-cmd --permanent --add-port=53/udp # firewall-cmd --permanent --add-port=53/tcp # firewall-cmd --reload +# firewall-cmd --list-all","title":"On the secondary server side:"},{"location":"add-secondarey-dns-server/#note1-cygrids-dns-servers","text":"@dns01.cygrids.net @dns02.cygrids.net 85.118.200.201","title":"Note1: Cygrids DNS servers:"},{"location":"add-secondarey-dns-server/#troublshooting","text":"1- reverse dns finns hos IP \u00e4garen #dig -x IP_ADDRESS 2-Network unreachable on IPv6: add OPTIONS=\"-4\" to nano -w /etc/sysconfig/named","title":"Troublshooting:"},{"location":"add-secondarey-dns-server/#note2-you-should-add-nameserver-ns4netsetse-hos-doman-registraren","text":"netset.com hos godaddy netset.se hos Loopia","title":"Note2: You should add Nameserver: ns4.netset.se hos dom\u00e4n registraren."},{"location":"add-secondarey-dns-server/#-","text":"","title":"--------------------------------------------------------"},{"location":"add-secondarey-dns-server/#dnssec","text":"# sudo dnssec-keygen -a RSASHA256 -b 2048 -n ZONE netsetdemo.com # sudo dnssec-keygen -f KSK -a RSASHA256 -b 4096 -n ZONE netsetdemo.com # dnssec-signzone -3 f55345c0803300b4 -A -N INCREMENT -o netsetdemo.com -t netsetdemo.com.hosts KSK=257 ZSK=256 RSASHA256= algorithm 8 flags aa=authoritative name server ra= recursive name server ad= the DNSSEC is enabled and used # dig DNSKEY netsetdemo.com. +multiline # dig +trace +noadditional DS netsetdemo.com. @8.8.8.8 | grep DS # dig @8.8.8.8 netsetdemo.com. DS # dig @ns.netset.se netset119.netset.com A +cd #!/bin/sh PDIR=`pwd` ZONEDIR=\"/srv/jails/nameserver/usr/local/etc/namedb\" #location of your zone files ZONE=$1 ZONEFILE=$2 DNSSERVICE=\"named\" #On CentOS/Fedora replace this with \"named\" cd $ZONEDIR SERIAL=`sudo jexec nameserver rndc zonestatus netsetdemo.com | grep signed |egrep -ho '[0-9]{10}'` sed -i 's/'$SERIAL'/'$(($SERIAL+1))'/' $ZONEFILE sudo dnssec-signzone -A -3 f55345c0803300b4 -N increment -o $1 -t $2 cd $PDIR # sudo jexec nameserver rndc reconfig # Add the keys to working directory named/working/ Test 1: lyckades cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze netsetdemo.com sudo nano -w netsetdemo.com.hosts % the key\u015b are in separate folder sudo dnssec-signzone -g -d keys/netsetdemo_256.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netsetdemo.com -t netsetdemo.com.hosts keys/netsetdemo_256.keys/Knetsetdemo.com.+008+02763.private keys/netsetdemo_256.keys/Knetsetdemo.com.+008+59581.private % If the keys are in the same folder as zonefile and the SOA serial is incremntal (not recommended) sudo dnssec-signzone -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -N INCREMENT -o netsetdemo.com -t netsetdemo.com.hosts sudo jexec nameserver rndc reload netsetdemo.com sudo jexec nameserver rndc thaw netsetdemo.com sudo jexec nameserver rndc zonestatus netsetdemo.com less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc status sudo jexec nameserver rndc signing -list netsetdemo.com ====================================================","title":"DNSSEC:"},{"location":"add-secondarey-dns-server/#zone-netsetcouk","text":"# cd /srv/jails/nameserver/usr/local/etc/namedb # sudo jexec nameserver rndc freeze netset.co.uk # sudo nano -w netset.co.uk.hosts # sudo dnssec-signzone -d keys/netset.co.uk.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.co.uk -t netset.co.uk.hosts keys/netset.co.uk.keys/Knetset.co.uk.+008+32134.private keys/netset.co.uk.keys/Knetset.co.uk.+008+42756.private # sudo jexec nameserver rndc reload netset.co.uk # sudo jexec nameserver rndc thaw netset.co.uk # sudo jexec nameserver rndc zonestatus netset.co.uk # less /srv/jails/nameserver/var/log/messages # sudo jexec nameserver rndc status ==================================================== Zone: nettailer.com sudo dnssec-keygen -a RSASHA256 -b 2048 -n ZONE nettailer.com sudo dnssec-keygen -f KSK -a RSASHA256 -b 4096 -n ZONE nettailer.com sudo jexec nameserver rndc freeze nettailer.com sudo nano -w nettailer.com.hosts sudo dnssec-signzone -d keys/nettailer.com.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.com -t nettailer.com.hosts keys/nettailer.com.keys/Knettailer.com.+008+65085.private keys/nettailer.com.keys/Knettailer.com.+008+61729.private sudo jexec nameserver rndc reload nettailer.com sudo jexec nameserver rndc thaw nettailer.com sudo jexec nameserver rndc zonestatus nettailer.com sudo jexec nameserver rndc status ==================================================== Zone: netset.io Edit zone then sudo dnssec-signzone -d keys/netset.io.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.io -t netset.io.hosts keys/netset.io.keys/Knetset.io.+008+16549.private keys/netset.io.keys/Knetset.io.+008+44718.private Then sudo jexec nameserver rndc reload sudo jexec nameserver rndc zonestatus netset.io less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc status ==================================================== Zone: netset.com 5 8 * * Mon /usr/home/nsadmin/sign-netset.com-zone cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze netset.com sudo nano -w netset.com.hosts sudo dnssec-signzone -d keys/netset.com.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.com -t netset.com.hosts keys/netset.com.keys/Knetset.com.+008+36214.private keys/netset.com.keys/Knetset.com.+008+64908.private sudo jexec nameserver rndc reload netset.com sudo jexec nameserver rndc thaw netset.com sudo jexec nameserver rndc zonestatus netset.com less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc status ==================================================== Zone: nettailer.co.uk cd /srv/jails/nameserver/usr/local/etc/namedb sudo nano -w nettailer.co.uk.hosts sudo dnssec-signzone -d keys/nettailer.co.uk.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.co.uk -t nettailer.co.uk.hosts keys/nettailer.co.uk.keys/Knettailer.co.uk.+008+23700.private keys/nettailer.co.uk.keys/Knettailer.co.uk.+008+45094.private sudo jexec nameserver rndc reload less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc zonestatus nettailer.co.uk ==================================================== Zone: netset.se cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze netset.se sudo nano -w netset.se.hosts sudo dnssec-signzone -d keys/netset.se.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.se -t netset.se.hosts keys/netset.se.keys/Knetset.se.+008+60556.private keys/netset.se.keys/Knetset.se.+008+04146.private sudo jexec nameserver rndc reload netset.se sudo jexec nameserver rndc thaw netset.se less /srv/jails/nameserver/var/log/messages","title":"ZONE: netset.co.uk"},{"location":"add-secondarey-dns-server/#sudo-jexec-nameserver-rndc-zonestatus-netsetse","text":"Zone: nettailer.se cd /srv/jails/nameserver/usr/local/etc/namedb sudo jexec nameserver rndc freeze nettailer.se sudo nano -w nettailer.se.hosts sudo dnssec-signzone -d keys/nettailer.se.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.se -t nettailer.se.hosts keys/nettailer.se.keys/Knettailer.se.+008+02454.private keys/nettailer.se.keys/Knettailer.se.+008+25465.private sudo jexec nameserver rndc reload nettailer.se sudo jexec nameserver rndc thaw nettailer.se less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc zonestatus nettailer.se ======================================================= Zone:nettailer.dk sudo dnssec-signzone -d keys/nettailer.dk.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o nettailer.dk -t nettailer.dk.hosts keys/nettailer.dk.keys/Knettailer.dk.+008+46938.private keys/nettailer.dk.keys/Knettailer.dk.+008+22066.private ======================================================= Zone: netset.eu sudo jexec nameserver rndc freeze netset.eu sudo nano -w netset.eu.hosts sudo dnssec-signzone -d keys/netset.eu.keys -3 $(head -c 1000 /dev/random | sha256 | cut -b 1-16) -A -o netset.eu -t netset.eu.hosts keys/netset.eu.keys/Knetset.eu.+008+54198.private keys/netset.eu.keys/Knetset.eu.+008+37339.private sudo jexec nameserver rndc reload netset.eu sudo jexec nameserver rndc thaw netset.eu less /srv/jails/nameserver/var/log/messages sudo jexec nameserver rndc zonestatus netset.eu ========================================================","title":"sudo jexec  nameserver rndc zonestatus netset.se"}]}